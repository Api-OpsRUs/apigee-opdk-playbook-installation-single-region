---
- name: Update planet cache
  import_playbook: apigee-planet-cache.yml
  vars:
    target_hosts: planet

- name: Install and configure OS pre-requisites
  import_playbook: apigee-os-pre-requisites.yml
  tags: ['os']
  vars:
    target_hosts: devportal

- name: Install and configure OS pre-requisites for DevPortal
  import_playbook: apigee-os-pre-requisites-devportal.yml
  tags: ['os']
  vars:
    target_hosts: devportal

- name: Install Apigee pre-requisites
  import_playbook: apigee-pre-requisites-bootstrap.yml
  tags: ['bootstrap']
  vars:
    target_hosts: devportal

- name: Install Apigee pre-requisites
  import_playbook: apigee-pre-requisites-common-install.yml
  tags: ['common']
  vars:
    target_hosts: devportal

- name: Apply configuration to DevPortal Database node
  import_playbook: install-devportal-postgres-component-setup.yml
  tags: ['pdb']
  vars:
    target_hosts: dp-db

- name: Apply configuration to DevPortal UI node
  import_playbook: install-devportal-ui-component-setup.yml
  tags: ['dp']
  vars:
    target_hosts: dp-ui

- name: Download logs and configs
  tags: ['logs']
  import_playbook: apigee-log-config-files.yml
  vars:
    target_hosts: planet
